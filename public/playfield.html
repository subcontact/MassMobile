<!DOCTYPE HTML>
<html>
    <head>
        <title>Playfield</title>
        <link rel="stylesheet" href="style.css" type="text/css" />
    </head>
    
    <body>
        <div id="main" class="main">&nbsp;</div>

        <div id="intro" style="display: none">
            <div class="small_tron_black">Back shortly...</div>

            <div class="bootcamp_title" style="font-size: 30pt;margin: 10%">www</div>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/lib/intro_playfield.js"></script>
        <script type="text/javascript"  src="jquery-2.0.3.min.js"> </script>
        <script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
        <script>
            var currentGame = null;
            var socket = io.connect("/playfield");

            var gameConfig = {}
            gameConfig.intro    = { section: "intro",   module: IntroPlayfield }; 

            // default starting game
            changeGame("intro");

            // Generic playfield functions
            socket.on("changeGame", function (newGame) {
                changeGame(newGame);
            });

            // Pass these on to the game
            socket.on('updates', function (updates) {
                currentGame.positionUpdates(updates);
            });
            socket.on('totals', function (totals) {
                currentGame.totalUpdates(totals);
            });
            socket.on('newuser', function (data) {
                currentGame.newUser(data);
            });
            socket.on('namechange', function (data) {
                currentGame.nameChange(data);
            });
            socket.on('woosout', function (data) {
                currentGame.woosOut(data);
            });
            socket.on('players', function (players) {
                currentGame.initPlayers(players);
            });
            socket.on("admin", function (message) {
                currentGame.admin(message);
            });
            socket.on("custom", function (data) {
                currentGame.processCustomMessage(data);
            });

            function changeGame(newGame) {
                // change the currentGame to new game and shutdown the old one.
                if (currentGame) currentGame.shutdown();

                // Testing a new launch model one by one...
                if (newGame == "quiz" || newGame == "worm" || newGame == "pong" || newGame == "presentation"
                        || newGame == "codecompetition"){
                    $("#main").load("/games/"+newGame+"/playfield.html", function () {
                        currentGame = initPlayfield();
                    });
                } else {
                    // the old way to load playfields                
        			if (!gameConfig[newGame]) {
                        alert("Game '" + newGame + "' is not supported yet...");
                        return;
                    }
                    
                    if (!document.getElementById(gameConfig[newGame].section)) {
                        alert("Weird, can't find the game section for " + newGame);
                        return;
                    }	

                    document.getElementById("main").innerHTML = document.getElementById(gameConfig[newGame].section).innerHTML;
                    currentGame = gameConfig[newGame].module;
                    
    				if (currentGame) { 
    					currentGame.init(socket);
    				} else {
    					alert("Cannot initialize the current game. Maybe its not written yet?");
    				}
                }
            }
        </script>
    </body>
</html>